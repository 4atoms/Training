<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="indexairplane.css">
</head>
    
<body>
     
    <h1>AIRLINES </h1>
    <div class="container">
        <img src="GettyImages-185298837.jpg" style="width: 100%; height: 30em;">
        <div  class="flightscollectionAPI" id="flightscollectionAPI" >
            <button onclick="DisplayFlightAPI()">Click Me for getting flight List</button>
        </div>
        <!-- <div id="flightscollection"></div> -->
        <h1 style="text-align: center; background-color: rgb(157, 182, 202);"> SEATS</h1>
        <div class="flex-container">
            <div class="first" id="first">
            </div>
            <div class="second" id="second">
            </div>
            <div class="third" id="third">
            </div>
        </div>
    </div>
    

    <script>

        const flights = [
            { flightname: "Kingfisher", seats: 45 },
            { flightname: "Vistara", seats: 56 },
            { flightname: "Indigo", seats: 137 },
            { flightname: "Air India", seats: 138 },
            { flightname: "Spice Jet", seats: 137 },
            { flightname: "Go Air", seats: 137 }
        ];
        //Class Iplementation
        class Airplane
        {
            name="";
            seats=0;
            renderSeats = ()=>{
                 console.log(`${this.name} ${this.seats}`);
                // OpenModal(this.seats);
            };
            //Constructor for Airplane
            constructor(name, seats) 
            {
                    this.name = name;
                    this.seats = seats;
            }
        }
        let aero1=new Airplane("AXJ",45);
        console.log(aero1);
        console.log(aero1.renderSeats());

        ListOfAllFlights= [{ "name": "Kingfishernew", "url": "https://run.mocky.io/v3/61473a53-5978-48ca-b689-e8418336d5c2" },{ "name": "Vistaranew", "url": "https://run.mocky.io/v3/97107e49-ceea-4972-876e-0cb4a2f79522"},{ "name": "Indigonew", "url": "https://run.mocky.io/v3/7a24b536-1115-47b2-b089-be962ccbbdbb" }];
        // https://run.mocky.io/v3/316a6e80-9ab6-4a57-a6b5-1adeacb04f2d
        function DisplayFlightAPI()
        {

            console.log("API called");
            var xhr = new XMLHttpRequest();
            xhr.open("GET","https://run.mocky.io/v3/316a6e80-9ab6-4a57-a6b5-1adeacb04f2d");
            xhr.onload = (resp) =>{
                var elem= document.getElementById("flightscollectionAPI");
                console.log("logging response " + resp);
                const {response}= resp.target;
                const JSONResp = JSON.parse(response);
                console.log(JSONResp);
                for(i=0;i<JSONResp.length;i++)
                {
                    
                    var onediv = document.createElement('div');
                    onediv.id = i + 'block';
                    onediv.textContent = JSONResp[i].name;
                    const name= JSONResp[i].name;
                    flightscollectionAPI.appendChild(onediv);
                    const url=JSONResp[i].url;
                    document.getElementById(i + 'block').innerHTML += `<button class='button4'  id="btn-${i}" onclick='CheckSeatCount("${url}")'></button>`;
                } 
            };
            xhr.send();
        }

        function CheckSeatCount(url)
        {
            console.log("Second API called");
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url,false);
            xhr.onload = (resp) => {
                console.log("logging response " + resp);
                const { response } = resp.target;
                const JSONResp = JSON.parse(response);
                console.log(JSONResp);
                var totalseats= JSONResp.seats;
                // let aero2 = new Airplane("AXJ", [totalseats]);
                // console.log(aero2.renderSeats());
                OpenModal(totalseats);                
            }; 
            xhr.send();
        }

        // function DisplayFlight()
        // {   
        //     for (i = 0; i < flights.length;i++)
        //     {       
        //         var onediv=document.createElement('div');
        //         onediv.id = i+'block';
        //         onediv.textContent=flights[i].flightname+"  "+flights[i].seats;
                
        //         flightscollection.appendChild(onediv);
        //         document.getElementById(i + 'block').innerHTML += `<button class='button4'  id=btn-${i} onclick="OpenModal(${flights[i].seats})"></button>`;
        //         // flightscollection.appendChild(onediv);           
        //     }
        // }
        
        function OpenModal(CountOfSeats)
        {
            document.getElementById("first").innerHTML =""
            document.getElementById("second").innerHTML = ""
            document.getElementById("third").innerHTML = ""
                console.log(CountOfSeats);
                for (j = 1; j <= CountOfSeats; j++)
                {   

                    for(k=0;k<3;k++)
                    {   
                        // if (j > CountOfSeats) {
                        //     document.createElement("div").appendChild("first");
                        // }
                        document.getElementById("first").innerHTML+= `<div class= "eachnumber" id="eachnumber${j}">` + [j] + '</div>';
                        j= j + 1;
                    }

                    for (l = 0; l< 4; l++) 
                    {   
                        if (j > CountOfSeats) {
                            document.getElementById("second").innerHTML += `<div class= "eachnumber" id="eachnumber${j}"></div>`;
                            
                        }
                        if(j<=CountOfSeats){
                            document.getElementById("second").innerHTML += `<div class= "eachnumber" id="eachnumber${j}">` + [j] + '</div>';
                            j = j + 1;
                        }
            
                    }

                    for (m = 0; m< 3; m++) 
                    {                            
                        if(m<2)
                        {
                            
                            document.getElementById("third").innerHTML += `<div class="eachnumber" id="eachnumber${j}">` + [j] + '</div>';
                            j = j + 1;
                        }

                        else if (m = 2) 
                        {
                            document.getElementById("third").innerHTML += `<div class="eachnumber" id="eachnumber${j}">` + [j] + '</div>';
                        }

                    }
                }
        }
        
        // DisplayFlight();       
    </script>
</body>
</html>