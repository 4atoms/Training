<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="indexairplane.css">
</head>
    
<body>
    <h1>AIRLINES </h1>
    <div id="flightscollectionAPI" >
        <button onclick="DisplayFlightAPI()">Click Me for getting flight List</button>
    </div>
    <div id="flightscollection">
    </div>

    <div class="flex-container flight-seats">
        <div class="first" id="first">
        </div>
        <div class="second" id="second">
        </div>
        <div class="third" id="third">
        </div>
    </div>
    

    <script>

        const flights = [
            { flightname: "Kingfisher", seats: 45 },
            { flightname: "Vistara", seats: 56 },
            { flightname: "Indigo", seats: 137 },
            { flightname: "Air India", seats: 138 },
            { flightname: "Spice Jet", seats: 137 },
            { flightname: "Go Air", seats: 137 }
        ];

        // Kingfishernew = "https://run.mocky.io/v3/61473a53-5978-48ca-b689-e8418336d5c2";
        // Vistaranew = "https://run.mocky.io/v3/97107e49-ceea-4972-876e-0cb4a2f79522";
        // Indigonew = "https://run.mocky.io/v3/7a24b536-1115-47b2-b089-be962ccbbdbb";

        ListOfAllFlights= [{ "name": "Kingfishernew", "url": "https://run.mocky.io/v3/61473a53-5978-48ca-b689-e8418336d5c2" },{ "name": "Vistaranew", "url": "https://run.mocky.io/v3/97107e49-ceea-4972-876e-0cb4a2f79522"},{ "name": "Indigonew", "url": "https://run.mocky.io/v3/7a24b536-1115-47b2-b089-be962ccbbdbb" }];
        // https://run.mocky.io/v3/316a6e80-9ab6-4a57-a6b5-1adeacb04f2d
        function DisplayFlightAPI()
        {

            console.log("API called");
            var xhr = new XMLHttpRequest();
            xhr.open("GET","https://run.mocky.io/v3/316a6e80-9ab6-4a57-a6b5-1adeacb04f2d");
            xhr.onload = (resp) =>{
                var elem= document.getElementById("flightscollectionAPI");
                console.log("logging response " + resp);
                const {response}= resp.target;
                const JSONResp = JSON.parse(response);
                console.log(JSONResp);
                for(i=0;i<JSONResp.length;i++)
                {
                    var onediv = document.createElement('div');
                    onediv.id = i + 'block';
                    onediv.textContent = JSONResp[i].name;

                    flightscollectionAPI.appendChild(onediv);
                    document.getElementById(i + 'block').innerHTML += `<button class='button4'  id=btn-${i} onclick="CheckSeatCount(${JSONResp[i].url})"></button>`;
                } 
            };
            xhr.send();
        }

        function CheckSeatCount(url)
        {
            console.log("Second API called");
            var xhr = new XMLHttpRequest();
            xhr.open("GET", url,false);
            xhr.onload = (resp) => {
                console.log("logging response " + resp);
                const { response } = resp.target;
                const JSONResp = JSON.parse(response);
                console.log(JSONResp);
                var totalseats= JSONResp.seats;
                OpenModal(totalseats);
            };
            xhr.send();
        }

        function DisplayFlight()
        {   
            for (i = 0; i < flights.length;i++)
            {       
                var onediv=document.createElement('div');
                onediv.id = i+'block';
                onediv.textContent=flights[i].flightname+"  "+flights[i].seats;
                
                flightscollection.appendChild(onediv);
                document.getElementById(i + 'block').innerHTML += `<button class='button4'  id=btn-${i} onclick="OpenModal(${flights[i].seats})"></button>`;
                // flightscollection.appendChild(onediv);           
            }
        }
        
        function OpenModal(CountOfSeats)
        {
            document.getElementById("first").innerHTML =""
            document.getElementById("second").innerHTML = ""
            document.getElementById("third").innerHTML = ""

                console.log(CountOfSeats);
                for (j = 1; j <= CountOfSeats; j++)
                {   

                    for(k=0;k<3;k++)
                    {   
                        // if (j > CountOfSeats) {
                        //     document.getElementById("first").style.visibility=hidden;
                        //     break;
                        // }
                        document.getElementById("first").innerHTML+= `<div class= "eachnumber" id="eachnumber${j}">` + [j] + '</div>';
                        j= j + 1;
                    }

                    for (l = 0; l< 4; l++) 
                    {
                        // if (j > CountOfSeats) {
                        //     document.getElementById("second").innerHTML += '<div class="eachnumber" id="eachnumberwaste"> </div>';
                        //     j=j+1;
                        //     break;
                        // }
                        document.getElementById("second").innerHTML += `<div class= "eachnumber" id="eachnumber${j}">` + [j] + '</div>';
                        j = j + 1;
                    }

                    for (m = 0; m< 3; m++) 
                    {
                        // if (j > CountOfSeats) {
                        //     document.getElementById("eachnumber${j}").style.visibility = hidden;
                        //     // document.getElementById("third").style.visibility = "hidden";
                        //     break;
                        // }
                        if(m<2)
                        {
                            document.getElementById("third").innerHTML += `<div class="eachnumber" id="eachnumber${j}">` + [j] + '</div>';
                            j = j + 1;
                        }

                        else if (m = 2) 
                        {
                            document.getElementById("third").innerHTML += `<div class="eachnumber" id="eachnumber${j}">` + [j] + '</div>';
                        }

                    }
                }
        }
        
        DisplayFlight();       
    </script>
</body>
</html>